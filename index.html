<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>File Maker — Quantum Luxe</title>
  <meta name="description" content="Create, save, and run files — with cosmic beauty." />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat+Alternates:wght@400;600;700&family=Exo+2:wght@300;400;500;600&family=JetBrains+Mono&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #ff00cc;
      --secondary: #00f7ff;
      --accent: #ffcc00;
      --bg: #000;
    }

    body {
      background: var(--bg);
      color: #fff;
      font-family: 'Exo 2', sans-serif;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      position: relative;
    }

    /* Background Layers */
    #background-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
    }

    #light-rays {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 30% 30%, rgba(106, 27, 154, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 70% 70%, rgba(0, 247, 255, 0.1) 0%, transparent 40%);
      z-index: -1;
      pointer-events: none;
    }

    /* Pages */
    .pages {
      display: flex;
      height: 100%;
      width: 300%;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      overflow-x: hidden;
      position: relative;
    }

    .page {
      width: 100vw;
      height: 100%;
      scroll-snap-align: start;
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      position: relative;
    }

    /* Glass Panel */
    .glass {
      background: rgba(10, 5, 25, 0.45);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 2rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255, 0, 204, 0.25);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
      position: relative;
      overflow: hidden;
    }

    .glass::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent), var(--primary));
      z-index: -1;
      border-radius: 26px;
      animation: borderRotate 8s linear infinite;
      opacity: 0.6;
    }

    @keyframes borderRotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Typography */
    h1 {
      font-family: 'Bebas Neue', cursive;
      font-size: 3.8rem;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-align: center;
      margin-bottom: 1.2rem;
      text-shadow: 0 0 15px rgba(255, 0, 204, 0.5);
      letter-spacing: 2px;
    }

    /* Buttons */
    .btn {
      padding: 0.9rem 1.6rem;
      border: none;
      border-radius: 16px;
      font-family: 'Montserrat Alternates', sans-serif;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.4s;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }

    .btn-primary::before {
      background: linear-gradient(135deg, var(--secondary), var(--accent));
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--secondary);
      color: var(--secondary);
    }

    .btn-outline::before {
      background: rgba(0, 247, 255, 0.2);
    }

    .btn:hover::before {
      opacity: 1;
    }

    .btn:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 8px 25px rgba(0, 247, 255, 0.5);
    }

    /* Textarea */
    textarea {
      width: 100%;
      height: 180px;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,0,204,0.3);
      border-radius: 16px;
      padding: 1.4rem;
      color: white;
      font-family: 'JetBrains Mono', monospace;
      margin: 1.2rem 0;
      resize: vertical;
      outline: none;
      transition: all 0.3s;
    }

    textarea:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(0, 247, 255, 0.3);
    }

    /* Formats */
    .formats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 1.2rem;
      margin: 1.5rem 0;
    }

    .format-btn {
      background: rgba(15,8,35,0.6);
      border: 1px solid rgba(255,0,204,0.2);
      border-radius: 16px;
      padding: 1rem 0.6rem;
      text-align: center;
      cursor: pointer;
      color: #eee;
      font-family: 'Exo 2', sans-serif;
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 1px;
      transition: all 0.4s;
      position: relative;
      overflow: hidden;
    }

    .format-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(255,0,204,0.2), rgba(0,247,255,0.2));
      opacity: 0;
      transition: opacity 0.3s;
    }

    .format-btn:hover::before {
      opacity: 1;
    }

    .format-btn:hover {
      transform: translateY(-5px) scale(1.05);
      border-color: var(--secondary);
      box-shadow: 0 8px 20px rgba(0,247,255,0.4);
    }

    .format-btn.selected {
      background: rgba(0,0,0,0.6);
      border: 2px solid var(--primary);
      color: var(--primary);
      box-shadow: 0 0 25px rgba(255,0,204,0.8);
      transform: scale(1.07);
      animation: selectedPulse 2s infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { box-shadow: 0 0 25px rgba(255,0,204,0.8); }
      50% { box-shadow: 0 0 40px rgba(255,0,204,1.2); }
    }

    /* History */
    .history-item {
      background: rgba(20,10,40,0.5);
      border: 1px solid rgba(0,247,255,0.2);
      border-radius: 16px;
      padding: 1.2rem;
      margin-bottom: 1.2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform 0.3s;
    }

    .history-item:hover {
      transform: translateY(-3px);
      border-color: var(--secondary);
    }

    /* Preview */
    .preview-container {
      width: 100%;
      height: 320px;
      border: 2px solid var(--secondary);
      border-radius: 16px;
      overflow: hidden;
      background: #050015;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Navigation */
    .nav {
      display: flex;
      justify-content: space-between;
      padding: 1.2rem 0;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }

    /* Footer */
    footer {
      text-align: center;
      margin-top: auto;
      padding-top: 1.8rem;
      color: #999;
      font-family: 'Exo 2', sans-serif;
      letter-spacing: 1px;
    }

    footer strong {
      color: var(--secondary);
    }

    /* Responsive */
    @media (max-width: 650px) {
      h1 { font-size: 2.8rem; }
      .glass { padding: 1.5rem; }
      .formats-grid { grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); }
    }

    @media (max-width: 480px) {
      h1 { font-size: 2.2rem; }
      .btn { padding: 0.8rem 1.2rem; font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <!-- Background -->
  <canvas id="background-canvas"></canvas>
  <div id="light-rays"></div>

  <!-- Pages -->
  <div class="pages" id="pages">
    <!-- PAGE 1: CREATE -->
    <div class="page" id="createPage">
      <div class="glass">
        <h1>CREATE FILE</h1>
        <textarea id="textInput" placeholder="Enter your code or content...">{
  "project": "File Maker",
  "edition": "Quantum Luxe",
  "developer": "Slow Poison"
}</textarea>

        <div class="formats-grid" id="formatGrid"></div>

        <div class="nav">
          <button class="btn btn-outline" disabled>← Back</button>
          <button class="btn btn-primary" id="nextToPreview">Next →</button>
        </div>
      </div>
      <footer>
        <p>© <span id="year">2024</span> File Maker — by <strong>Slow Poison</strong></p>
      </footer>
    </div>

    <!-- PAGE 2: HISTORY -->
    <div class="page" id="historyPage">
      <div class="glass">
        <h1>MY FILES</h1>
        <div id="historyList">
          <p id="noHistory">No saved files yet.</p>
        </div>
        <div class="nav">
          <button class="btn btn-outline" id="backToCreate">← Back</button>
          <button class="btn btn-primary" id="nextToPreviewFromHistory">Preview →</button>
        </div>
      </div>
      <footer>
        <p>Tap a file to load it.</p>
      </footer>
    </div>

    <!-- PAGE 3: PREVIEW -->
    <div class="page" id="previewPage">
      <div class="glass">
        <h1>RUN CODE</h1>
        <p style="text-align:center; margin-bottom:1.2rem; opacity:0.85; font-family:'Exo 2';">Sandboxed preview (HTML/JS/CSS only)</p>
        <div class="preview-container">
          <iframe id="previewFrame" sandbox="allow-scripts"></iframe>
        </div>
        <div class="nav">
          <button class="btn btn-outline" id="backToHistory">← Back</button>
          <button class="btn btn-primary" id="downloadFromPreview">Download</button>
        </div>
      </div>
      <footer>
        <p>Safe execution — no network access.</p>
      </footer>
    </div>
  </div>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // === QUANTUM ORB BACKGROUND ===
    const canvas = document.getElementById('background-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const orbs = [];
    const mouse = { x: canvas.width / 2, y: canvas.height / 2 };

    window.addEventListener('mousemove', (e) => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });

    class Orb {
      constructor() {
        this.reset();
        this.z = Math.random() * 100;
        this.baseSize = Math.random() * 30 + 10;
      }

      reset() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.vx = (Math.random() - 0.5) * 0.3;
        this.vy = (Math.random() - 0.5) * 0.3;
        this.color = `hsl(${Math.random() * 360}, 80%, 70%)`;
        this.alpha = Math.random() * 0.3 + 0.1;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        if (this.x < -50 || this.x > canvas.width + 50 || this.y < -50 || this.y > canvas.height + 50) {
          this.reset();
        }
        const dx = mouse.x - this.x;
        const dy = mouse.y - this.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 150) {
          this.vx += dx * 0.0005;
          this.vy += dy * 0.0005;
        }
      }

      draw() {
        const size = this.baseSize * (1 + Math.sin(Date.now() / 1000 + this.z) * 0.2);
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.shadowColor = this.color;
        ctx.shadowBlur = 20;
        ctx.beginPath();
        ctx.arc(this.x, this.y, size, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.restore();
      }
    }

    function initOrbs() {
      for (let i = 0; i < 25; i++) {
        orbs.push(new Orb());
      }
    }

    function animateBackground() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      orbs.forEach(orb => {
        orb.update();
        orb.draw();
      });
      requestAnimationFrame(animateBackground);
    }

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    initOrbs();
    animateBackground();

    // === Rest of App Logic (same as before but cleaner) ===
    document.getElementById('year').textContent = new Date().getFullYear();

    let selectedFormat = { ext: 'json', name: 'JSON', mime: 'application/json' };
    let currentContent = '';
    let currentFilename = 'file-maker.json';

    const formats = [
      { ext: 'txt', name: 'TXT', mime: 'text/plain' },
      { ext: 'html', name: 'HTML', mime: 'text/html' },
      { ext: 'css', name: 'CSS', mime: 'text/css' },
      { ext: 'js', name: 'JS', mime: 'application/javascript' },
      { ext: 'json', name: 'JSON', mime: 'application/json' },
      { ext: 'py', name: 'Python', mime: 'text/x-python' },
      { ext: 'md', name: 'Markdown', mime: 'text/markdown' },
      { ext: 'csv', name: 'CSV', mime: 'text/csv' },
      { ext: 'xml', name: 'XML', mime: 'application/xml' },
      { ext: 'pdf', name: 'PDF', mime: 'application/pdf' }
    ];

    const formatGrid = document.getElementById('formatGrid');
    formats.forEach(fmt => {
      const btn = document.createElement('div');
      btn.className = 'format-btn';
      btn.textContent = fmt.name;
      if (fmt.ext === 'json') btn.classList.add('selected');
      btn.addEventListener('click', () => {
        document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedFormat = fmt;
      });
      formatGrid.appendChild(btn);
    });

    // Navigation
    const pages = document.getElementById('pages');
    let currentPage = 0;

    function goToPage(index) {
      currentPage = index;
      pages.scrollTo({ left: index * window.innerWidth, behavior: 'smooth' });
      if (index === 2) renderPreview();
    }

    document.getElementById('nextToPreview').addEventListener('click', () => {
      currentContent = document.getElementById('textInput').value;
      currentFilename = `file-maker.${selectedFormat.ext}`;
      goToPage(2);
    });

    document.getElementById('backToCreate').addEventListener('click', () => goToPage(0));
    document.getElementById('nextToPreviewFromHistory').addEventListener('click', () => goToPage(2));
    document.getElementById('backToHistory').addEventListener('click', () => goToPage(1));

    // Download & Save
    document.getElementById('downloadFromPreview').addEventListener('click', () => {
      if (selectedFormat.ext === 'pdf') {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        pdf.setFontSize(11);
        const lines = pdf.splitTextToSize(currentContent, 180);
        pdf.text(lines, 10, 10);
        pdf.save(currentFilename);
      } else {
        const blob = new Blob([currentContent], { type: selectedFormat.mime });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = currentFilename;
        a.click();
        URL.revokeObjectURL(url);
      }
      saveToHistory(currentFilename, currentContent, selectedFormat.ext);
      loadHistory();
    });

    // History
    function saveToHistory(name, content, ext) {
      const history = JSON.parse(localStorage.getItem('fileMakerHistory') || '[]');
      const newItem = { name, content, ext, timestamp: Date.now() };
      history.unshift(newItem);
      if (history.length > 20) history.pop();
      localStorage.setItem('fileMakerHistory', JSON.stringify(history));
    }

    function loadHistory() {
      const list = document.getElementById('historyList');
      const history = JSON.parse(localStorage.getItem('fileMakerHistory') || '[]');
      if (history.length === 0) {
        list.innerHTML = '<p id="noHistory">No saved files yet.</p>';
        return;
      }
      list.innerHTML = '';
      history.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div>
            <strong>${item.name}</strong><br>
            <small>${new Date(item.timestamp).toLocaleString()}</small>
          </div>
          <div>
            <button class="btn btn-outline" onclick="loadHistoryItem(${i})">Load</button>
            <button class="btn btn-outline" style="border-color:#ff0000;color:#ff0000;" onclick="deleteHistoryItem(${i})">Del</button>
          </div>
        `;
        list.appendChild(div);
      });
    }

    window.loadHistoryItem = function(index) {
      const history = JSON.parse(localStorage.getItem('fileMakerHistory') || '[]');
      const item = history[index];
      document.getElementById('textInput').value = item.content;
      const fmt = formats.find(f => f.ext === item.ext) || formats[0];
      selectedFormat = fmt;
      document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('selected'));
      const btn = [...document.querySelectorAll('.format-btn')].find(b => b.textContent === fmt.name);
      if (btn) btn.classList.add('selected');
      goToPage(0);
    };

    window.deleteHistoryItem = function(index) {
      let history = JSON.parse(localStorage.getItem('fileMakerHistory') || '[]');
      history.splice(index, 1);
      localStorage.setItem('fileMakerHistory', JSON.stringify(history));
      loadHistory();
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.target.id === 'historyPage' && entry.isIntersecting) {
          loadHistory();
        }
      });
    }, { threshold: 0.5 });
    observer.observe(document.getElementById('historyPage'));

    // Preview
    function renderPreview() {
      const frame = document.getElementById('previewFrame');
      if (['html', 'htm'].includes(selectedFormat.ext)) {
        const blob = new Blob([currentContent], { type: 'text/html' });
        frame.src = URL.createObjectURL(blob);
      } else if (selectedFormat.ext === 'js') {
        const html = `<!DOCTYPE html><html><body><script>${currentContent}<\/script></body></html>`;
        const blob = new Blob([html], { type: 'text/html' });
        frame.src = URL.createObjectURL(blob);
      } else if (selectedFormat.ext === 'css') {
        const html = `<!DOCTYPE html><html><head><style>${currentContent}<\/style></head><body><h2>CSS Preview</h2></body></html>`;
        const blob = new Blob([html], { type: 'text/html' });
        frame.src = URL.createObjectURL(blob);
      } else {
        frame.src = 'data:text/html,<h2 style="color:#00f7ff;text-align:center;margin-top:20px;">Preview not available for this format.</h2>';
      }
    }

    // Swipe
    let startX = 0;
    pages.addEventListener('touchstart', e => { startX = e.touches[0].clientX; });
    pages.addEventListener('touchend', e => {
      const endX = e.changedTouches[0].clientX;
      const diff = startX - endX;
      if (Math.abs(diff) > 50) {
        if (diff > 0 && currentPage < 2) goToPage(currentPage + 1);
        else if (diff < 0 && currentPage > 0) goToPage(currentPage - 1);
      }
    });

    // Init
    loadHistory();
  </script>
</body>
</html>